# 키움증권 실현손익 시각화 프로젝트 완료

키움증권 REST API를 통해 실현손익 데이터를 수집하고 Streamlit 대시보드로 시각화하는 프로젝트를 완료했습니다.

## 🎯 프로젝트 목표

1. ✅ 키움증권 REST API 연동
2. ✅ 구글 시트 데이터 저장
3. ✅ Streamlit 대시보드 시각화
4. ✅ 모바일/웹 접근 가능

---

## 🔄 주요 작업 내역

### 1. API 전환: KIS → 키움증권

**문제 발견**: 초기 코드가 한국투자증권(KIS) API 기반이었음

**해결**: 키움증권 REST API로 완전 재작성
- **au10001**: OAuth 토큰 발급
- **ka10073**: 일자별종목별실현손익요청_기간

**테스트 결과**: ✅ 151건 데이터 조회 성공

---

### 2. 전체 데이터 수집

**기간**: 2023년 12월 ~ 2026년 1월 (26개월)

**수집 방법**: 월별 분할 조회 (`collect_all_data.py`)

**결과**:
- **총 수집 건수**: 4,184건
- **구글 시트 저장**: 4,194건
- **주요 데이터**: 2025년 집중

---

### 3. Streamlit 대시보드 UI 개선

사용자 피드백을 반영하여 6가지 개선사항 적용:

#### ✅ 1. 주요 지표 - 테이블 형식

**문제**: 총 실현손익 금액이 잘려서 보이지 않음

**해결**: 테이블 형식으로 변경

```html
<table class="metric-table">
  <tr>
    <td>총 실현손익</td>
    <td class="metric-value">25,883,002원</td>
  </tr>
</table>
```

![주요 지표 테이블](file:///Users/20eung/.gemini/antigravity/brain/cdac0ac8-486d-4fd5-927d-82a7cfe68e4e/dashboard_top_1767338775656.png)

#### ✅ 2. 실현손익 분포 제거

**문제**: 불필요한 차트

**해결**: `plot_profit_distribution()` 함수 및 차트 제거

#### ✅- [x] 종목별 실현손익 필터 제거 및 Top 10 고정

**문제**: 종목이 많아서 스크롤이 너무 심함

**해결**: Top 10/20/50 필터 추가

```python
top_filter = st.radio(
    "표시 개수",
    options=["전체", "Top 10", "Top 20", "Top 50"],
    index=2  # 기본값: Top 20
)
```

#### ✅ 4. 순서 변경

**문제**: 거래 내역이 아래에 있어서 접근성 떨어짐

**해결**: 거래 내역 ↔ 종목별 실현손익 순서 변경

**새로운 순서**:
1. 주요 지표
2. 누적 수익 차트
3. **거래 내역** (위로 이동)
4. **종목별 실현손익** (아래로 이동)

#### ✅ 5. 접힘/펼침 기능

**문제**: 모든 섹션이 항상 펼쳐져 있어서 스크롤이 많음

**해결**: `st.expander()` 적용

```python
with st.expander("📈 주요 지표", expanded=True):
    # 내용
    
with st.expander("📋 거래 내역", expanded=True):
    # 내용
    
with st.expander("📊 종목별 실현손익", expanded=True):
    # 내용
```

#### ✅ 6. 사이드바 토글

**문제**: 좁은 화면에서 사이드바가 공간을 많이 차지함

**해결**: 사이드바 기본 숨김 + 햄버거 버튼

```python
st.set_page_config(
    initial_sidebar_state="collapsed"  # 기본 숨김
)
```

![사이드바 토글](file:///Users/20eung/.gemini/antigravity/brain/cdac0ac8-486d-4fd5-927d-82a7cfe68e4e/dashboard_final_view_1767338820606.png)

---

## 📊 최종 대시보드 구성

### 주요 지표
- 총 실현손익: **25,883,002원**
- 총 거래건수: **4,194건**
- 승률: **99.9%**
- 평균 수익: **6,171원**

### 차트
1. **누적 실현손익 추이**: 시간에 따른 수익 변화
2. **종목별 실현손익**: Top 20 종목 (필터 가능)

### 데이터 테이블
- 날짜 범위 필터
- 종목 선택 필터
- 최신순 정렬

---

## 🎉 프로젝트 완료!

### 달성 사항
✅ 키움증권 REST API 연동 완료
✅ 4,184건 데이터 수집 완료
✅ 구글 시트 저장 완료
✅ Streamlit 대시보드 구현 완료
✅ UI/UX 개선 완료

### 다음 단계
1. Streamlit Cloud 배포
2. 자동화 스케줄링 설정
3. 모바일 접근 테스트

**구글 시트 URL**: https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE

**로컬 대시보드**: http://localhost:8501

---

## 📅 2026-01-02 추가 개선 사항

### 1. 주요 지표 테이블 개선

#### ✅ 연도별 통계 표시
- 기존 전체 통계 → 연도별 구분 표시로 변경
- 첫 거래 연도부터 현재 연도까지 모든 연도 표시
- 각 연도별 실현손익, 거래건수, 평균수익 계산
- 데이터 기간 표시 추가 (📅 기간: YYYY-MM-DD ~ YYYY-MM-DD)

#### 💎 프리미엄 UI 전면 리뉴얼 (V2.0)
- **글래스모피즘(Glassmorphism)**: 반투명 카드 레이아웃과 블러 효과로 현대적인 깊이감 구현
- **고도화된 색상 시스템**: Emerald(수익), Rose(손실), Deep Indigo(포인트) 팔레트 적용
- **타이포그래피**: Google Fonts 'Outfit' 도입으로 세련된 톤앤매너 완성
- **차트 동기화**: 모든 Plotly 차트의 스타일(폰트, 컬러, 레이아웃)을 UI 시스템과 완벽히 일치시킴
- **인터랙티브 네비게이션**: 사이드바에 애니메이션이 적용된 카드형 메뉴 제공

#### 구현 단계
- [x] 글로벌 디자인 시스템 (CSS Variables, Typography) 구축
- [x] 메인 헤더 및 레이아웃 프리미엄 리뉴얼
- [x] 테이블 및 카드 컴포넌트 고도화 디자인 적용
- [x] 차트 시스템 디자인 동기화 (Plotly 스타일 업데이트)

### 검증 단계
- [x] 전체 UI 디자인 일관성 및 시각적 완성도 검증
- [x] 모바일 및 반응형 레이아웃 확인
- [x] 사용자 최종 만족도 피드백 확인
- [x] '뒤로가기' 버튼 및 네비게이션 확인
- [x] GitHub 업로드 및 WALKTHROUGH 업데이트
필터링하여 일별 실현손익 및 거래건수 표시

**구현 방식**:
```python
# Session state 초기화
if 'selected_year' not in st.session_state:
    st.session_state.selected_year = None

# 연도 클릭 시 월별 뷰로 전환
if st.button(f"{year}년", key=f"year_{year}"):
    st.session_state.selected_year = year
    st.rerun()
```

#### ✅ 값 글자 크기 조정
- '값' 컬럼의 글자 크기를 '항목' 컬럼과 동일하게 변경
- CSS에서 `font-size: 1.5rem` 제거

### 2. 종목별 실현손익 차트 개선

#### ✅ Top N 필터 수정
**문제**: Top 10 선택 시 20개 표시 (상위 10개 + 하위 10개)

**해결**: 상위 N개만 표시하도록 로직 수정
```python
# 변경 전
top_stocks = stock_summary.nlargest(top_n, '총수익_만원')
bottom_stocks = stock_summary.nsmallest(top_n, '총수익_만원')
stock_summary = pd.concat([bottom_stocks, top_stocks])

# 변경 후
stock_summary = stock_summary.nlargest(top_n, '총수익_만원')
```

#### ✅ 디폴트 값 변경
- Top 20 → Top 10으로 기본값 변경

#### ✅ 차트 레이아웃 개선
- 오른쪽 여백 증가 (250px → 350px) - 금액 라벨 완전 표시
- x축 범위 최적화 (최대값의 105%로 설정) - 막대 길이 극대화
- x축 선 표시 추가 (`showline=True`, `mirror=True`)
- 막대 간격 최소화 (`bargap=0.1`)

#### ✅ 금액 라벨 스타일 조정
- 글꼴: Arial Black → 기본 글꼴
- 크기: 14px → 12px (종목명과 동일)

### 3. 거래 내역 테이블 개선

#### ✅ 날짜 형식 변경
- 시간 정보 제거, 날짜만 표시 (YYYY-MM-DD)

#### ✅ 정렬 순서 변경
- 실현손익 내림차순 정렬

#### ✅ 컬럼 순서 변경
- 새로운 순서: 날짜, 종목명, 종목코드, 수익률, 실현손익, 체결가, 체결량

#### ✅ 숫자 포맷 및 정렬
- `st.column_config.NumberColumn` 사용
- 모든 숫자 컬럼 오른쪽 정렬
- 천 단위 구분 기호 추가

### 4. 기간 선택 UI 개선

#### ✅ 라디오 버튼 추가
- 옵션: 오늘, 이번주, 이번달, 올해, 전체, 사용자화
- 기본값: 오늘
- 한 줄에 모두 표시되도록 글꼴 크기 조정

#### ✅ 주요 지표 - 불필요한 열 제거
- "평균수익" 열이 실제 분석에 큰 도움이 되지 않아 제거
- 연도별 및 월별 통계 테이블 모두 적용하여 테이블을 더 깔끔하게 개선

#### ✅ 종목별 실현손익 필터 단순화
- 사이드바의 표시 개수 필터(Top 10/20 등)를 제거하여 UI 단순화
- 차트에서는 항상 분석 가치가 높은 상위 10개 종목만 표시하도록 고정

#### ✅ 화면 레이아웃 최적화
- **상단 여백 축소**: CSS 수정을 통해 대시보드 상단 여백을 대폭 줄여 정보 밀도 향상
#### ✅ 2. 3단계 데이터 드릴다운 시스템
- **연도별 뷰**: 전체 기간의 연도별 성과 요약 및 선택
- **월별 뷰**: 특정 연도 선택 시, 6열 2행 그리드 시스템을 통한 월별 통계 제공
- **일별 뷰**: 월 선택 시 해당 월의 상세 일별 실현손익 분석
- **네비게이션**: 단계별 '뒤로가기' 버튼 및 사이드바 퀵 내비게이션 연동

#### 💎 3. 프리미엄 UI/UX 전면 리뉴얼 (V2.0)
- **Glassmorphism**: 반투명 카드 레이아웃과 블러 효과로 정제된 아름다움 구현
- **Custom Design System**: Emerald/Rose/Indigo 기반의 독자적인 컬러 시스템 및 Outfit 폰트 적용
- **Smart Scrolling**: 사이드바 메뉴 클릭 시 섹션 타이틀바에 정확히 안착하는 스마트 스크롤 로직
- **애니메이션**: 각 익스팬더 카드에 부드러운 호버 애니메이션(Lift-up) 적용
- **가독성 최적화 (v2.1)**: 연도별/월별/일별 통계 테이블의 행 간격을 폰트 크기의 1.5배 수준으로 축소하여 정보 밀도 향상
- [x] 주요 지표 레이아웃 정밀 조정 (v2.2~v2.5)
- [x] 메인 헤더 타이틀 폰트 축소 및 1줄 최적화 (v2.6)
- [x] 버튼 극소화 및 폰트/행간격 정밀 최적화 (v2.7~v2.9)
- [x] 레이아웃 긴급 안정화 및 복구 (v3.0)
- [x] 불필요한 섹션 구분선 제거 및 미니멀 최적화 (v3.1)
- [x] 종목별 차트 여백 최적화 및 X축 제거 (v3.2~v3.3)
- [x] 모든 차트 높이 축소(70%) 및 라벨 잘림 방지 (v3.4)
- [x] 키움 API 수동 업데이트 버튼 기능 구현 (v4.0)
- [x] 사이드바 UI 정교화 및 동기화 오류 가이드 개선 (v4.1)
- **간격 정밀 최적화 (v2.3)**:
  - 버튼과 테이블 사이의 마진을 최소화(1.5rem → 0.2rem)하여 물리적 간극 해소
  - 안내 문구 및 버튼 행의 마진을 미세 조정하여 컴팩트한 시각적 밸런스 완성
- **내비게이션 정밀 조정 (v2.4~v2.5)**:
  - '뒤로가기' 버튼 크기 축소(height 1.6rem) 및 폰트 최적화
  - Streamlit `vertical_alignment="center"` 및 전역 CSS 선택자 최적화를 통한 완벽한 수직 중앙 정렬 구현
  - 비효율적인 HTML 래퍼 구조를 제거하여 렌더링 안정성 확보
- **헤더 1줄 최적화 (v2.6)**:
  - 메인 타이틀 폰트 크기를 조정(3.5rem → 2.8rem)하여 영어 제목이 줄바꿈 없이 1줄로 표시되도록 개선
  - 서브타이틀과의 수직 간격을 재조정하여 상단 영역의 시각적 균형감 확보
- **버튼 극소화 및 비율 조정 (v2.7~v2.8)**:
  - 버튼 폰트 크기를 14pt로 축소하고, 높이를 폰트의 150%(1.5em) 수준으로 정밀 조정하여 정보 밀도 극대화
  - Streamlit 위젯 고유 ID(`data-testid`) 추적 방식을 통한 스타일 적용 보장
- **폰트 일치 및 행 간격 최적화 (v2.9)**:
  - 버튼 폰트 크기를 안내 문구와 동일한 **0.9rem**으로 축소하여 시각적 통일성 확보
- **레이아웃 긴급 안정화 (v3.0)**:
  - 요소 간 겹침 현상을 유발하던 과도한 네거티브 마진 제거 및 안내 문구 여백 복구
  - 버튼 행 사이의 간격을 **0.6rem**으로 미세 조정하여 정보 밀도와 가독성의 최적 균형 확보
- **미니멀리즘 정제 (v3.1)**:
  - 카드(익스팬더) 기반 레이아웃의 완성도를 높이기 위해 불필요한 섹션 구분선(st.divider) 제거
  - 시각적 소음을 최소화하여 세련된 대시보드 무드 완성
- **차트 밀도 향상 (v3.2~v3.4)**:
  - '종목별 실현손익' 차트 상단의 과도한 여백 축소 및 제목 위치 조정
  - 중복되는 정보 제거를 위해 차트 하단 X축(수치 및 제목)을 완전히 숨김(visible=False) 처리
  - 모든 차트 높이를 기존 대비 70% 수준(**280px**)으로 축소하여 초고밀도 레이아웃 완성
  - 차트 상단 수치 라벨이 잘리는 현상을 방지하기 위해 데이터 기반 Y축 자동 여유 공간 확보 로직 적용
- **키움 API 수동 동기화 및 UI 정교화 (v4.0~v4.1)**:
  - 사이드바에 **🚀 Sync** 버튼을 추가하여 키움증권 REST API 연동 기능 통합
  - 버튼 레이아웃을 2행 구조로 변경하여 시각적 밸런스 및 가로 너비 최적화
  - 각 버튼의 용도를 설명하는 캡션을 추가하여 사용자 편의성 증대
  - API 설정 누락 시 상세한 가이드와 함께 오류 메시지를 표시하도록 개선

---

## 🎉 프로젝트 최종 완성!

### 달성 사항
- ✅ 키움증권 REST API 연동 및 4,000건 이상의 데이터 수집 완료
- ✅ 구글 시트 저장 및 실시간 대시보드 연동 완료
- ✅ **글래스모피즘 기반의 프리미엄 UI 리뉴얼 완료**
- ✅ **3단계 정밀 드릴다운 분석 시스템 구축 완료**
- ✅ 모든 UI 버그(폰트 깨짐, 스크롤 오프셋 등) 수정 및 최적화 완료

---

**구글 시트 URL**: https://docs.google.com/spreadsheets/d/YOUR_SHEET_ID_HERE

**GitHub 저장소**: https://github.com/20eung/Kiwoom-Profit-Visualizer
